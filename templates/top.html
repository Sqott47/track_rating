{% extends "base.html" %}

{% block title %}–¢–æ–ø —Ç—Ä–µ–∫–æ–≤ ¬∑ ANTIGAZ{% endblock %}

{% block content %}
<div class="page-content">
    <section class="top-panel">
        <div class="top-panel-main">
            <div class="top-panel-label">–¢–æ–ø —Ç—Ä–µ–∫–æ–≤</div>
            <p class="top-panel-subtext">
                –í—Å–µ –æ—Ü–µ–Ω—ë–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∏, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ —Å—Ä–µ–¥–Ω–µ–º—É –±–∞–ª–ª—É.
            </p>
        </div>
    </section>

    <section class="top-list-section">
        <div class="top-table-card">
            <div class="top-table-wrapper">
            <table class="top-table">
                <thead>
                <tr>
                    <th>#</th>
                    <th>–¢—Ä–µ–∫</th>
                    <th class="{% if sort_by == 'streamers' %}top-col-active{% endif %}">
                        <a href="{{ url_for('top_tracks',
                                            page=page,
                                            sort_by='streamers',
                                            direction=('asc' if sort_by == 'streamers' and direction == 'desc' else 'desc')) }}"
                           class="top-sort-header-link">
                            <span>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</span>
                            {% if sort_by == 'streamers' %}
                                <span class="top-sort-arrow">
                                    {% if direction == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}
                                </span>
                            {% endif %}
                        </a>
                    </th>
                    <th class="{% if sort_by == 'viewers' %}top-col-active{% endif %}">
                        <a href="{{ url_for('top_tracks',
                                            page=page,
                                            sort_by='viewers',
                                            direction=('asc' if sort_by == 'viewers' and direction == 'desc' else 'desc')) }}"
                           class="top-sort-header-link">
                            <span>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
                            {% if sort_by == 'viewers' %}
                                <span class="top-sort-arrow">
                                    {% if direction == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}
                                </span>
                            {% endif %}
                        </a>
                    </th>
                </tr>
                </thead>
                <tbody id="top-table-body">
                {% for t in tracks %}
                    <tr class="top-row" data-track-id="{{ t.id }}">
                        <td class="top-pos" data-label="#">{{ t.position }}</td>
                        <td class="top-name-cell" data-label="–¢—Ä–µ–∫">
                            <span class="top-name-text">{{ t.name }}</span>
                            {% if t.award_wins and t.award_wins|length %}
                                {% set b = t.award_wins[0] %}
                                <span class="award-pill award-pill--win rt-tooltip-target"
                                      data-rt-tooltip="win"
                                      data-rt-award="{{ b.title|e }}"
                                      data-rt-kind="–ü–æ–±–µ–¥–∏—Ç–µ–ª—å">
                                    <span class="award-pill-emoji">{{ b.emoji }}</span>
                                </span>
                            {% elif t.award_noms and t.award_noms|length %}
                                {% set b = t.award_noms[0] %}
                                <span class="award-pill rt-tooltip-target"
                                      data-rt-tooltip="nom"
                                      data-rt-award="{{ b.title|e }}"
                                      data-rt-kind="–ù–æ–º–∏–Ω–∞–Ω—Ç">
                                    <span class="award-pill-emoji">{{ b.emoji }}</span>
                                </span>
                            {% endif %}
                            {% if is_admin %}
                            <span class="top-row-actions">
                                <button type="button"
                                        class="top-action-btn top-action-rename"
                                        title="–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ç—Ä–µ–∫"
                                        data-track-id="{{ t.id }}"
                                        data-track-name="{{ t.name }}">
                                    ‚úèÔ∏è
                                </button>
                                <button type="button"
                                        class="top-action-btn top-action-delete"
                                        title="–£–¥–∞–ª–∏—Ç—å —Ç—Ä–µ–∫"
                                        data-track-id="{{ t.id }}"
                                        data-track-name="{{ t.name }}">
                                    üóë
                                </button>

                            </span>
                            {% endif %}
                        </td>
                        <td data-label="–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª">
                            <span class="top-score-chip score-chip">
                                {% if t.avg_streamers is not none %}
                                    {{ "%.2f"|format(t.avg_streamers) }}
                                {% else %}
                                    ?
                                {% endif %}
                            </span>
                        </td>
                        <td data-label="–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π">
                            <span class="top-score-chip top-score-chip-viewer score-chip">
                                {% if t.avg_viewers is not none %}
                                    {{ "%.2f"|format(t.avg_viewers) }}
                                {% else %}
                                    ?
                                {% endif %}
                            </span>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        </div>

        <div class="pagination-row">
            {% if page > 1 %}
                <a class="page-link" href="{{ url_for('top_tracks', page=page-1, sort_by=sort_by, direction=direction) }}">¬´ –ù–∞–∑–∞–¥</a>
            {% else %}
                <span class="page-link page-link-disabled">¬´ –ù–∞–∑–∞–¥</span>
            {% endif %}

            <span class="page-info">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page }} –∏–∑ {{ total_pages }}</span>

            {% if page < total_pages %}
                <a class="page-link" href="{{ url_for('top_tracks', page=page+1, sort_by=sort_by, direction=direction) }}">–í–ø–µ—Ä—ë–¥ ¬ª</a>
            {% else %}
                <span class="page-link page-link-disabled">–í–ø–µ—Ä—ë–¥ ¬ª</span>
            {% endif %}
        </div>
    </section>
</div>


<div class="modal-backdrop" id="track-modal-backdrop">
    <div class="modal-card">
        <div class="modal-header">
            <div>
                <div class="modal-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Ç—Ä–µ–∫—É</div>
                <div class="modal-subtitle" id="track-modal-subtitle">–¢—Ä–µ–∫: ‚Äî</div>
            </div>
            <button type="button" class="modal-close-btn" id="track-modal-close">√ó</button>
        </div>
        <div class="modal-body">
            <div class="modal-columns">
                <div class="modal-col">
                    <h3 class="modal-section-title">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º</h3>
                    <table class="stats-table">
                        <thead>
                            <tr>
                                <th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
                                <th>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</th>
                            </tr>
                        </thead>
                        <tbody id="track-modal-criteria-body"></tbody>
                    </table>
                </div>
                <div class="modal-col">
                    <h3 class="modal-section-title">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                    <table class="stats-table" style="display:none;">
                        <thead>
                            <tr>
                                <th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
                                <th>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</th>
                            </tr>
                        </thead>
                        <tbody id="track-modal-viewers-criteria-body"></tbody>
                    </table>
                    <div class="modal-overall">
                        <div class="modal-overall-label">–ò—Ç–æ–≥–æ–≤—ã–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –ø–æ —Ä–µ—Ü–µ–Ω–∑–∏—è–º:</div>
                        <div class="modal-overall-row">
                            <div class="modal-overall-value score-chip" id="track-modal-viewers-overall">?</div>
                        </div>
                    </div>
                </div>
                <div class="modal-col">
                    <h3 class="modal-section-title">–û—Ü–µ–Ω—â–∏–∫–∏</h3>
                    <table class="stats-table">
                        <thead>
                            <tr>
                                <th>–û—Ü–µ–Ω—â–∏–∫</th>
                                <th>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</th>
                            </tr>
                        </thead>
                        <tbody id="track-modal-raters-body"></tbody>
                    </table>
                    <div class="modal-overall">
                        <div class="modal-overall-label">–ò—Ç–æ–≥–æ–≤—ã–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –ø–æ —Ç—Ä–µ–∫—É:</div>
                        <div class="modal-overall-row">
                            <div class="modal-overall-value score-chip" id="track-modal-overall">0.00</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn-secondary" id="track-modal-open-page" >
                    –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç—Ä–µ–∫–∞
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
