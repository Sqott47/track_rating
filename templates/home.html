{% extends "base.html" %}

{% block title %}ANTIGAZ ¬∑ Company{% endblock %}

{% block head_extra %}
<style>
.news-attachment-block {
    margin-top: 8px;
}
.news-attachment-image {
    display: block;
    max-width: 100%;
    border-radius: 12px;
    margin-top: 4px;
}
.news-attachment-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 14px;
    opacity: 0.9;
}
.news-attachment-link:hover {
    opacity: 1;
}
</style>
{% endblock %}

{% block content %}
<div class="page-content home-page">
    <section class="home-hero">
        <div class="home-hero-main">
            <div class="home-hero-kicker">ANTIGAZ COMPANY</div>
            <h1 class="home-hero-title">ANTIGAZ–ò–©–ï</h1>
            <p class="home-hero-subtitle">
                –°—Ç—Ä–∏–º—ã, –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ü–µ–Ω–∫–∞ —Ç—Ä–µ–∫–æ–≤, —Ç–æ–ø—ã –∏ –∏—Å—Ç–æ—Ä–∏—è &mdash; –≤—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.
            </p>
            <div class="home-hero-tags">
                <span class="hero-tag">üî• –°—Ç—Ä–∏–º—ã</span>
                <span class="hero-tag">üéß –¢—Ä–µ–∫–∏</span>
                <span class="hero-tag">üß™ –û–±—ä–µ–∫—Ç–∏–≤–Ω–∞—è –æ—Ü–µ–Ω–∫–∞</span>
            </div>
        </div>
        <div class="home-hero-side">
            <div class="home-hero-card">
                <div class="home-hero-card-label">–°—Ç–∞—Ç—É—Å</div>
                <div class="home-hero-card-value">
                    {% if stream_info %}
                        <span class="live-dot"></span>
                        <span>–û–Ω–ª–∞–π–Ω: {{ stream_info.title }}</span>
                    {% else %}
                        <span class="live-dot live-dot-idle"></span>
                        <span>–°–µ–π—á–∞—Å —Ç–∏—Ö–æ, –Ω–æ —ç—Ç–æ –Ω–µ–Ω–∞–¥–æ–ª–≥–æ.</span>
                    {% endif %}
                </div>
                {% if stream_info and stream_info.url %}
                    <a href="{{ stream_info.url }}" class="hero-link" target="_blank" rel="noopener">
                        –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∏–º
                    </a>
                {% endif %}
            </div>
        </div>
    </section>

    <section class="home-layout">
        <div class="home-main-column">
            <section class="home-section">
                <div class="home-section-header">
                    <h2 class="home-section-title">–ù–æ–≤–æ—Å—Ç–∏</h2>
                    <p class="home-section-subtitle">
                        –ö—Ä—É–ø–Ω—ã–µ –∞–ø–¥–µ–π—Ç—ã, –∞–Ω–æ–Ω—Å—ã –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –¥–≤–∏–∂—É—Ö–∞ ANTIGAZ.
                    </p>
                </div>
                <div class="home-news-list">
                    {% if news_items %}
                        {% for n in news_items %}
                            <article class="news-card">
                                <div class="news-meta">
                                    {% if n.tag %}
                                        <span class="news-tag">{{ n.tag }}</span>
                                    {% endif %}
                                    {% if n.date %}
                                        <span class="news-date">{{ n.date }}</span>
                                    {% endif %}
                                </div>
                                <h3 class="news-title">{{ n.title }}</h3>
                                {% if n.text %}
                                    <p class="news-text">{{ n.text|safe }}</p>
                                {% endif %}

                                {% if n.attachment %}
                                    <div class="news-attachment-block">
                                        {% if n.attachment_is_image %}
                                            <a href="{{ url_for('static', filename='uploads/' ~ n.attachment) }}" target="_blank" rel="noopener">
                                                <img src="{{ url_for('static', filename='uploads/' ~ n.attachment) }}"
                                                     alt="–í–ª–æ–∂–µ–Ω–∏–µ –∫ –Ω–æ–≤–æ—Å—Ç–∏"
                                                     class="news-attachment-image">
                                            </a>
                                        {% else %}
                                            <a href="{{ url_for('static', filename='uploads/' ~ n.attachment) }}"
                                               target="_blank"
                                               rel="noopener"
                                               class="news-attachment-link">
                                                üìé –í–ª–æ–∂–µ–Ω–∏–µ –∫ –Ω–æ–≤–æ—Å—Ç–∏
                                            </a>
                                        {% endif %}
                                    </div>
                                {% endif %}
                            </article>
                        {% endfor %}
                    {% else %}
                        <p class="home-empty">–ó–¥–µ—Å—å –ø–æ–∫–∞ –Ω–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π, –Ω–æ —ç—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ.</p>
                    {% endif %}
                
            {% if news_pagination and news_pagination.pages > 1 %}
            <div class="home-pagination">
                {% if news_pagination.has_prev %}
                    <a class="pager-link" href="{{ url_for('home', page=news_pagination.prev_num) }}">&larr; –ü—Ä–µ–¥—ã–¥—É—â–∏–µ</a>
                {% endif %}
                <span class="pager-info">
                    –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ news_pagination.page }} –∏–∑ {{ news_pagination.pages }}
                </span>
                {% if news_pagination.has_next %}
                    <a class="pager-link" href="{{ url_for('home', page=news_pagination.next_num) }}">–°–ª–µ–¥—É—é—â–∏–µ &rarr;</a>
                {% endif %}
            </div>
            {% endif %}
</div>
            </section>
        </div>

        <aside class="home-sidebar">
            <section class="home-section home-widget">
                <div class="home-section-header">
                    <h2 class="home-section-title">–ú–∏–Ω–∏‚Äë—Ç–æ–ø —Ç—Ä–µ–∫–æ–≤</h2>
                    <p class="home-section-subtitle">–¢–æ–ø‚Äë3 –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É —Ä–µ–π—Ç–∏–Ω–≥—É —Å—Ç—Ä–∏–º–µ—Ä–æ–≤.</p>
                </div>
                {% if top_tracks %}
                    <ol class="mini-top-list">
                        {% for t in top_tracks %}
                            <li class="mini-top-item">
                                <button type="button"
                                        class="mini-top-button"
                                        onclick="openTrackDetailsModal({{ t.id }})">
                                    <span class="mini-top-pos">#{{ loop.index }}</span>
                                    <span class="mini-top-name">{{ t.name }}</span>
                                    {% if t.avg_score is defined and t.avg_score is not none %}
                                        <span class="top-score-chip score-chip mini-top-score">
                                            {{ '%.2f'|format(t.avg_score) }}
                                        </span>
                                    {% endif %}
                                </button>
                            </li>
                        {% endfor %}
                    </ol>
                    <a href="{{ url_for('top_tracks') }}" class="hero-link secondary-link">
                        –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–ª–Ω–æ–º—É —Ç–æ–ø—É
                    </a>
                {% else %}
                    <p class="home-empty">–¢–æ–ø –ø–æ–∫–∞ –ø—É—Å—Ç &mdash; –Ω—É–∂–Ω–æ –∫–æ–º—É‚Äë—Ç–æ —É–∂–µ –Ω–∞—á–∏–Ω–∞—Ç—å —Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫–∏.</p>
                {% endif %}
            </section>

            <section class="home-section home-widget">
                <div class="home-section-header">
                    <h2 class="home-section-title">–ù–µ–¥–∞–≤–Ω–æ –æ—Ü–µ–Ω—ë–Ω–Ω—ã–µ</h2>
                    <p class="home-section-subtitle">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–µ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—à–ª–∏ —á–µ—Ä–µ–∑ –æ—Ü–µ–Ω–∫—É.</p>
                </div>
                {% if recent_tracks %}
                    <ul class="history-list">
                        {% for t in recent_tracks %}
                            <li class="history-item">
                                <button type="button"
                                        class="history-button"
                                        onclick="openTrackDetailsModal({{ t.id }})">
                                    <div class="history-main">
                                        <span class="history-name">{{ t.name }}</span>
                                        {% if t.final_score is defined and t.final_score is not none %}
                                            <span class="top-score-chip score-chip history-score">
                                                {{ '%.2f'|format(t.final_score) }}
                                            </span>
                                        {% endif %}
                                    </div>
                                    {% if t.created_at %}
                                        <div class="history-meta">
                                            <span class="history-date">{{ t.created_at.strftime('%d.%m.%Y') }}</span>
                                        </div>
                                    {% endif %}
                                </button>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="home-empty">–ù–µ–¥–∞–≤–Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ü–µ–Ω–∏–≤–∞–ª–∏, —Å–∞–º–æ–µ –≤—Ä–µ–º—è —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.</p>
                {% endif %}
            </section>
        </aside>
    </section>
</div>

{# –ú–æ–¥–∞–ª–∫–∞ —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø–æ —Ç—Ä–µ–∫—É —Ç–∞–∫–∞—è –∂–µ, –∫–∞–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–ø–∞ #}
<div class="modal-backdrop" id="track-modal-backdrop">
    <div class="modal-card">
        <div class="modal-header">
            <div>
                <div class="modal-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Ç—Ä–µ–∫—É</div>
                <div class="modal-subtitle" id="track-modal-subtitle">–¢—Ä–µ–∫: ‚Äî</div>
            </div>
            <button type="button" class="modal-close-btn" id="track-modal-close">√ó</button>
        </div>
        <div class="modal-body">
            <div class="modal-columns">
                <div class="modal-col">
                    <h3 class="modal-section-title">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º</h3>
                    <table class="stats-table">
                        <thead>
                            <tr>
                                <th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
                                <th>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</th>
                            </tr>
                        </thead>
                        <tbody id="track-modal-criteria-body"></tbody>
                    </table>
                </div>
                <div class="modal-col">
                    <h3 class="modal-section-title">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –∑—Ä–∏—Ç–µ–ª–µ–π –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º</h3>
                    <table class="stats-table">
                        <thead>
                            <tr>
                                <th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
                                <th>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</th>
                            </tr>
                        </thead>
                        <tbody id="track-modal-viewers-criteria-body"></tbody>
                    </table>
                    <div class="modal-overall">
                        <div class="modal-overall-label">–ò—Ç–æ–≥–æ–≤—ã–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –∑—Ä–∏—Ç–µ–ª–µ–π:</div>
                        <div class="modal-overall-row">
                            <div class="modal-overall-value score-chip" id="track-modal-viewers-overall">?</div>
                        </div>
                    </div>
                </div>
                <div class="modal-col">
                    <h3 class="modal-section-title">–û—Ü–µ–Ω—â–∏–∫–∏</h3>
                    <table class="stats-table">
                        <thead>
                            <tr>
                                <th>–û—Ü–µ–Ω—â–∏–∫</th>
                                <th>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</th>
                            </tr>
                        </thead>
                        <tbody id="track-modal-raters-body"></tbody>
                    </table>
                    <div class="modal-overall">
                        <div class="modal-overall-label">–ò—Ç–æ–≥–æ–≤—ã–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –ø–æ —Ç—Ä–µ–∫—É:</div>
                        <div class="modal-overall-row">
                            <div class="modal-overall-value score-chip" id="track-modal-overall">0.00</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn-secondary" id="track-modal-open-page">
                    –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç—Ä–µ–∫–∞
                </a>
            </div>
        </div>
    </div>
</div>

<style>
.news-attachment-block {
    margin-top: 8px;
}
.news-attachment-image {
    display: block;
    max-width: 100%;
    border-radius: 12px;
    margin-top: 4px;
}
.news-attachment-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 14px;
    opacity: 0.9;
}
.news-attachment-link:hover {
    opacity: 1;
}
</style>

{% endblock %}
