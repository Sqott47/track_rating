{% extends "base.html" %}

{% block title %}–ü—Ä–µ–º–∏–∏ ¬∑ ANTIGAZ{% endblock %}

{% block content %}
<div class="page-content">
  <section class="top-panel">
    <div class="top-panel-main">
      <div class="top-panel-label">–ü—Ä–µ–º–∏–∏</div>
      <p class="top-panel-subtext">–≠—Ç–æ —á—Ç–æ, –ø—Ä–µ–º–∏—è –ê–ù–¢–ò–ì–ê–ó?</p>
    </div>
  </section>

  <section class="awards-layout">
    <aside class="awards-col awards-col--left">
      <div class="awards-col-head">
        <div class="awards-col-title">–°–ø–∏—Å–æ–∫ –ø—Ä–µ–º–∏–π</div>
        {% if is_admin %}
          <button class="btn-ghost" type="button" onclick="document.getElementById('award-create').classList.toggle('is-open')">+ –°–æ–∑–¥–∞—Ç—å</button>
        {% endif %}
      </div>

      {% if is_admin %}
      <div class="award-create" id="award-create">
        <form method="post" action="{{ url_for('awards_create') }}" data-turbo="false" enctype="multipart/form-data">
          <div class="form-row">
            <label class="field-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
            <input class="field-input" name="title" maxlength="255" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¢—Ä–µ–∫ –º–µ—Å—è—Ü–∞" required>
          </div>
          <div class="form-row">
            <label class="field-label">–°–º–∞–π–ª–∏–∫ (–¥–ª—è —Ç–æ–ø–∞)</label>
            <input class="field-input" name="icon_emoji" maxlength="16" placeholder="üèÜ">
            <div class="field-hint">–í —Ç–æ–ø–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç —Å–º–∞–π–ª–∏–∫ + tooltip.</div>
          </div>
          <div class="form-row">
            <label class="field-label">–ö–∞—Ä—Ç–∏–Ω–∫–∞ (–æ–ø—Ü.)</label>
            <input class="field-input" type="file" name="image" accept="image/*">
          </div>
          <div class="form-row">
            <label class="field-label">–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü.)</label>
            <textarea class="field-input" name="description" rows="2" placeholder="–ö–æ—Ä–æ—Ç–∫–æ –æ –ø—Ä–µ–º–∏–∏"></textarea>
          </div>
          <div class="form-actions">
            <button class="btn-primary" type="submit">–°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–º–∏—é</button>
          </div>
        </form>
      </div>
      {% endif %}

      <div class="awards-list" id="awards-list">
        {% if active_awards %}
          {% for a in active_awards %}
            <div class="award-item {% if selected_award and selected_award.id == a.id %}is-active{% endif %}" data-award-item>
              <a class="award-link"
                 href="{{ url_for('awards_panel', award_id=a.id) }}"
                 data-award-link
                 data-award-id="{{ a.id }}"
                 data-award-title="{{ a.title|e }}"
                 data-award-description="{{ (a.description or '')|e }}"
                 data-award-emoji="{{ (a.icon_emoji or '')|e }}"
                 data-award-image="{{ (a.image_path or '')|e }}"
                 data-turbo-frame="award-panel">
                <div class="award-link-main">
                  {% if a.image_path %}
                    <img class="award-thumb" src="{{ a.image_path }}" alt="" onerror="this.style.display='none';">
                  {% endif %}
                  <div class="award-link-text">
                    <div class="award-link-title">{{ a.title }}</div>
                    {% if a.description %}
                      <div class="award-link-desc">{{ a.description }}</div>
                    {% endif %}
                  </div>
                </div>
                <div class="award-link-meta">
                  <span class="award-count">{{ a.nominations.count() }}</span>
                </div>
              </a>

              {% if is_admin %}
              <div class="award-item-actions">
                <button type="button" class="btn-ghost btn-mini award-edit-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" data-award-edit>‚úèÔ∏è</button>
                <form method="post" action="{{ url_for('awards_delete', award_id=a.id) }}" data-turbo="false" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–µ–º–∏—é ¬´{{ a.title|e }}¬ª?');">
                  <button type="submit" class="btn-ghost btn-mini" title="–£–¥–∞–ª–∏—Ç—å">üóë</button>
                </form>
              </div>
              {% endif %}
            </div>
          {% endfor %}
        {% else %}
          <div class="field-hint">–ü–æ–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–µ–º–∏–π –Ω–µ—Ç.</div>
        {% endif %}

        {% if ended_awards %}
          <details class="awards-ended" {% if selected_award and selected_award.status == 'ended' %}open{% endif %}>
            <summary class="awards-ended-summary">
              –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ <span class="muted">({{ ended_awards|length }})</span>
            </summary>
            <div class="awards-ended-list">
              {% for a in ended_awards %}
                <div class="award-item {% if selected_award and selected_award.id == a.id %}is-active{% endif %}" data-award-item>
                  <a class="award-link"
                     href="{{ url_for('awards_panel', award_id=a.id) }}"
                     data-award-link
                     data-award-id="{{ a.id }}"
                     data-award-title="{{ a.title|e }}"
                     data-award-description="{{ (a.description or '')|e }}"
                     data-award-emoji="{{ (a.icon_emoji or '')|e }}"
                     data-award-image="{{ (a.image_path or '')|e }}"
                     data-turbo-frame="award-panel">
                    <div class="award-link-main">
                      {% if a.image_path %}
                        <img class="award-thumb" src="{{ a.image_path }}" alt="" onerror="this.style.display='none';">
                      {% endif %}
                      <div class="award-link-text">
                        <div class="award-link-title">{{ a.title }}</div>
                        {% if a.description %}
                          <div class="award-link-desc">{{ a.description }}</div>
                        {% endif %}
                      </div>
                    </div>
                    <div class="award-link-meta">
                      <span class="award-count">{{ a.nominations.count() }}</span>
                    </div>
                  </a>
                </div>
              {% endfor %}
            </div>
          </details>
        {% endif %}
      </div>
    </aside>

    {% if is_admin %}
      <div class="award-modal" id="award-edit-modal" hidden>
        <div class="award-modal__backdrop" data-award-modal-close></div>
        <div class="award-modal__card">
          <div class="award-modal__head">
            <div class="award-modal__title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–º–∏—é</div>
            <button type="button" class="btn-ghost" data-award-modal-close>‚úï</button>
          </div>
          <form id="award-edit-form" method="post" action="" enctype="multipart/form-data" data-turbo="false">
            <div class="form-row">
              <label class="field-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
              <input class="field-input" name="title" id="award-edit-title" maxlength="255" required>
            </div>
            <div class="form-row">
              <label class="field-label">–°–º–∞–π–ª–∏–∫ (–¥–ª—è —Ç–æ–ø–∞)</label>
              <input class="field-input" name="icon_emoji" id="award-edit-emoji" maxlength="16" placeholder="üèÜ">
            </div>
            <div class="form-row">
              <label class="field-label">–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü.)</label>
              <textarea class="field-input" name="description" id="award-edit-description" rows="2"></textarea>
            </div>
            <div class="form-row">
              <label class="field-label">–ö–∞—Ä—Ç–∏–Ω–∫–∞ (–æ–ø—Ü.)</label>
              <input class="field-input" type="file" name="image" accept="image/*">
              <label class="field-hint" style="display:flex; gap:8px; align-items:center; margin-top:8px;">
                <input type="checkbox" name="clear_image" value="1"> –£–±—Ä–∞—Ç—å —Ç–µ–∫—É—â—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É
              </label>
            </div>
            <div class="form-actions">
              <button class="btn-primary" type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              <button class="btn-ghost" type="button" data-award-modal-close>–û—Ç–º–µ–Ω–∞</button>
            </div>
          </form>
        </div>
      </div>
    {% endif %}

    <turbo-frame id="award-panel" class="awards-col awards-col--panel" src="{% if selected_award %}{{ url_for('awards_panel', award_id=selected_award.id) }}{% endif %}">
      <div class="award-panel-empty">–í—ã–±–µ—Ä–∏ –ø—Ä–µ–º–∏—é —Å–ª–µ–≤–∞.</div>
    </turbo-frame>
  </section>
</div>
{% endblock %}
