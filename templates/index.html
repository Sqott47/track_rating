{% extends "base.html" %}

{% block title %}–û—Ü–µ–Ω–∫–∞ —Ç—Ä–µ–∫–æ–≤ ¬∑ –ü–∞–Ω–µ–ª—å{% endblock %}
<script>
(function () {
  var openBtn = document.getElementById('btn-open-clear-queue');
  var backdrop = document.getElementById('clear-queue-modal-backdrop');
  var closeBtn = document.getElementById('clear-queue-close-btn');
  var cancelBtn = document.getElementById('clear-queue-cancel-btn');

  if (!openBtn || !backdrop) return;

  function openModal() {
    backdrop.classList.add('is-open');
    backdrop.setAttribute('aria-hidden', 'false');
  }
  function closeModal() {
    backdrop.classList.remove('is-open');
    backdrop.setAttribute('aria-hidden', 'true');
  }

  openBtn.addEventListener('click', openModal);
  if (closeBtn) closeBtn.addEventListener('click', closeModal);
  if (cancelBtn) cancelBtn.addEventListener('click', closeModal);

  backdrop.addEventListener('click', function (e) {
    if (e.target === backdrop) closeModal();
  });

  document.addEventListener('keydown', function (e) {
    if (e.key === 'Escape' && backdrop.classList.contains('is-open')) closeModal();
  });
})();
</script>


{% block body_class %}has-docked-player{% endblock %}

{% block content %}
<div class="page-content">
    <section class="top-panel">
        <div class="top-panel-main">
            <div class="top-panel-label">–¢–µ–∫—É—â–∏–π —Ç—Ä–µ–∫</div>
            <div class="track-current">
                <span class="track-current-label">–°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç:</span>
                <span class="track-current-value" id="track-name-display">‚Äî</span>
            </div>
        </div>
    </section>
<section class="controls-bar">
        <div class="controls-left">
            <div class="controls-rating-join" style="display:inline-flex; gap:8px; margin-left:8px;">
                <button type="button" class="btn-primary" id="join-rating-btn">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –æ—Ü–µ–Ω–∫–µ</button>
                <button type="button" class="btn-ghost" id="leave-rating-btn" style="display:none;">–ü–æ–∫–∏–Ω—É—Ç—å –æ—Ü–µ–Ω–∫—É</button>
            </div>

            <div class="track-input-row controls-track-input">
                <label class="track-label">
                    <input id="track-name-input"
                           type="text"
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞"
                           autocomplete="off">
                </label>
            </div>
        </div>
        <div class="controls-right">
            <button type="button" class="btn-primary" id="evaluate-btn">
                –û—Ü–µ–Ω–∏—Ç—å —Ç—Ä–µ–∫
            </button>
            <button type="button" class="btn-ghost" id="new-track-btn">
                –ù–æ–≤—ã–π —Ç—Ä–µ–∫
            </button>
{% if is_admin %}
            <button type="button" class="btn-danger-outline" id="btn-open-clear-queue">
                üóë –û—á–∏—Å—Ç–∏—Ç—å –æ—á–µ—Ä–µ–¥—å
            </button>
            {% endif %}
        </div>
    </section>


    
<aside id="queue-panel" class="queue-dock-left" aria-label="–û—á–µ—Ä–µ–¥—å —Ç—Ä–µ–∫–æ–≤">
            <div class="queue-list-card">
                <div class="queue-card-header">
                    <div>
                        <div class="queue-card-title">–û—á–µ—Ä–µ–¥—å</div>
                        <div class="queue-card-subtitle">–¢—Ä–µ–∫–∏ –æ—Ç –∑—Ä–∏—Ç–µ–ª–µ–π (wav/mp3, –¥–æ 50 –ú–ë)</div>
                    </div>
                    <div class="queue-card-meta">
                        <div id="queue-count-meta">‚Äî</div>
</div>
                </div>

                <div class="queue-items" id="queue-items"></div>
                <div class="queue-empty" id="queue-empty" style="display:none;">
                    –û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞.
                </div>
            </div>
        </aside>

<section class="panels-section">
    <div class="panels-grid" id="panels-container"></div>
</section>


    <footer class="global-footer">
        <div class="global-total-card">
            <div class="global-total-label">–ò—Ç–æ–≥–æ–≤—ã–π –æ–±—â–∏–π –±–∞–ª–ª –ø–æ —Ç—Ä–µ–∫—É:</div>
            <div class="global-total-value score-chip" id="global-total">0.0</div>
        </div>
    </footer>
</div>

{% if is_admin %}
<div class="modal-backdrop" id="clear-queue-modal-backdrop" aria-hidden="true">
    <div class="modal-card modal-card--sm" role="dialog" aria-modal="true" aria-labelledby="clear-queue-title">
        <div class="modal-header">
            <div>
                <div class="modal-title" id="clear-queue-title">–û—á–∏—Å—Ç–∏—Ç—å –æ—á–µ—Ä–µ–¥—å?</div>
                <div class="modal-subtitle">–ê–¥–º–∏–Ω-–¥–µ–π—Å—Ç–≤–∏–µ</div>
            </div>
            <button type="button" class="modal-close-btn" id="clear-queue-close-btn" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
        </div>
        <div class="modal-body">
            <p class="muted" style="margin:0; line-height: 1.45;">
                –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —É–±–µ—Ä—ë—Ç –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Ç—Ä–µ–∫–∏ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –ø–æ—Å–ª–µ —Å—Ç—Ä–∏–º–∞. –û—Ç–º–µ–Ω–∏—Ç—å –±—É–¥–µ—Ç –Ω–µ–ª—å–∑—è.
            </p>
        </div>
        <div class="modal-footer modal-footer--row">
            <button type="button" class="btn-secondary" id="clear-queue-cancel-btn">–û—Ç–º–µ–Ω–∞</button>
            <form method="post" action="{{ url_for('admin_clear_queue') }}">
                <input type="hidden" name="confirm" value="yes">
                <button type="submit" class="btn-danger">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </form>
        </div>
    </div>
</div>
{% endif %}

<script>
    window.INITIAL_STATE = {{ initial_state|tojson }};
    window.USER_ROLE = {{ (session.get('role') or '')|tojson }};
    window.IS_ADMIN = {{ is_admin|tojson }};
</script>


<script>
(function () {
  var openBtn = document.getElementById('btn-open-clear-queue');
  var backdrop = document.getElementById('clear-queue-modal-backdrop');
  var closeBtn = document.getElementById('clear-queue-close-btn');
  var cancelBtn = document.getElementById('clear-queue-cancel-btn');

  if (!openBtn || !backdrop) return;

  function openModal() {
    backdrop.classList.add('is-open');
    backdrop.setAttribute('aria-hidden', 'false');
  }
  function closeModal() {
    backdrop.classList.remove('is-open');
    backdrop.setAttribute('aria-hidden', 'true');
  }

  openBtn.addEventListener('click', openModal);
  if (closeBtn) closeBtn.addEventListener('click', closeModal);
  if (cancelBtn) cancelBtn.addEventListener('click', closeModal);

  backdrop.addEventListener('click', function (e) {
    if (e.target === backdrop) closeModal();
  });

  document.addEventListener('keydown', function (e) {
    if (e.key === 'Escape' && backdrop.classList.contains('is-open')) closeModal();
  });
})();
</script>

{% endblock %}